<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>COW</title>


    <script src="scripts/js/libs/jquery-1.11.0.js"></script>

    <link href="css/bootstrap.css" rel="stylesheet" />
    <link href="css/styles.css" rel="stylesheet" />
    <script src="scripts/js/libs/bootstrap.js"></script>

    <script src="scripts/js/libs/knockout-3.0.0.debug.js"></script>
    <script src="scripts/js/libs/knockout.mapping.js"></script>

    <script src="scripts/js/libs/stomp.js"></script>
    <script src="scripts/js/libs/sockjs-0.3.min.js"></script>

    <script src="scripts/config.js"></script>
    <script src="scripts/js/mylibs/cow-lib.js"></script>
    <script src="scripts/js/mylibs/tasks.js"></script>
</head>
<body>

    <table class="table table-hover table-condensed details-drop" style="border-collapse:collapse;">
        <caption>Tasks</caption>
        <thead>
            <tr>
                <th> ID </th>
                <th> Name </th>
                <th> Workflow </th>
                <th> Description </th>
                <th> State </th>

            </tr>
        </thead>
        <tbody data-bind="foreach: assignedTasks">
            <tr data-toggle="collapse" class="accordion-toggle" data-bind="attr: {'data-target': '#' + id()}, css: { 'odd': $index() % 2 != 0 }">
                <td data-bind="text: id"></td>
                <td data-bind="text: name"></td>
                <td data-bind="text: processInstanceId"></td>
                <td data-bind="text: description"></td>
                <td data-bind="text: state"></td>
        </tr>
        <tr>
            <td class="hiddenRow" colspan="42">
                <div class="accordian-body collapse" data-bind="attr: {id: id}">
                    <table class="detailsTable">
                        <tbody>
                            <tr>
                                <td>
                                    <strong>Details for task  </strong><strong data-bind="text: id"></strong>
                                    <dl class="name-value-pair">
                                        <dt>Name</dt>
                                        <dd data-bind="text: name"></dd>
                                    </dl>
                                    <dl class="name-value-pair">
                                        <dt>Description</dt>
                                        <dd data-bind="text: description"></dd>
                                    </dl>
                                    <dl class="name-value-pair">
                                        <dt>Workflow</dt>
                                        <dd data-bind="text: processInstanceId"></dd>
                                    </dl>
                                    <dl class="name-value-pair">
                                        <dt>Task ID</dt>
                                        <dd data-bind="text: id"></dd>
                                    </dl>
                                    <dl class="name-value-pair">
                                        <dt>State</dt>
                                        <dd data-bind="text: state"></dd>
                                    </dl>
                                    <dl class="name-value-pair">
                                        <dt>Activity Name</dt>
                                        <dd data-bind="text: activityName"></dd>
                                    </dl>
                                    <dl class="name-value-pair">
                                        <dt>State</dt>
                                        <dd data-bind="text: state"></dd>
                                    </dl>
                                    <dl class="name-value-pair">
                                        <dt>Assignee</dt>
                                        <dd data-bind="text: assignee"></dd>
                                    </dl>
                                    <!-- Form to select the task outcome, only shown when task has possible outcomes -->
                                </td>
                                
                                <td>
                                   <!-- Variable edit section -->
                                    <div>
                                        <strong>Variables</strong>
                                        <!-- Each variable's editors appear in a li -->
                                        <ul class="form-inline" data-bind="foreach: variables">
                                            <!-- Only add class 'has-error' when the view model says there is an error with
                                            the section's variable -->
                                            <li class="form-group" data-bind="css: {'has-error': $parent.variableHasConflict($data)}">
                                                <!-- Only show help when the view model says there is an error with
                                                the section's variable -->
                                                <label class="help-block" data-bind="visible: $parent.variableHasConflict($data)">
                                                    Cannot have duplicate variable names
                                                </label>
                                                Name: <input class="form-control" data-bind="value: name"/>
                                                Value: <input class="form-control" data-bind="value: value"/>
                                                <button data-bind="click: $parent.removeVariable">
                                                    <span class="glyphicon glyphicon-trash"></span>
                                                </button>
                                            </li>
                                            </br>
                                        </ul>
                                    <button data-bind="click: addVariable">
                                        <span class="glyphicon glyphicon-plus"></span>
                                    </button>

                                </div>
                                </td>
                                <td>
                                    <form id="outcomes-form" class="form-inline"
                                    data-bind="visible: outcomes().length > 0">
                                        <!-- help-block only shows up after the user tries to complete the task
                                        without selecting an outcome -->
                                        <p class="help-block hidden">Must select an outcome</p>

                                        <strong class="control-label">Outcomes</strong>
                                        <label data-bind="foreach: outcomes" class="radio">
                                            <input type="radio" name="selectedOutcome"
                                            data-bind="checked: $parent.selectedOutcome, value: $data"/>
                                            <!-- Display the outcome name next to its radio button -->
                                            <span data-bind="text: $data"></span>
                                            </br>
                                        </label>
                                    </form>
                                </td>
                                
                                    
                                
                            </tr>
                        </tbody>
                    </table>
                    <button type="button" class="btn btn-primary completeTask" 
                                        data-bind="visible: canCompleteTask, disable: hasVariableConflicts, click: $root.completeTask">
                                         Complete Task
                    </button>
                </div>
            </td>
        </tr>
    </tbody>    
</table>

<table class="table table-hover table-condensed details-drop" style="border-collapse:collapse;">
    <caption>Available Tasks</caption>
    <thead>
        <tr>
            <th> ID </th>
            <th> Name </th>
            <th> Workflow </th>
            <th> Description </th>
            <th> State </th>
            <th> </th>
        </tr>
    </thead>
    <tbody data-bind="foreach: availableTasks">
        <tr data-toggle="collapse" class="accordion-toggle" data-bind="attr: {'data-target': '#' + id()}, css: { 'odd': $index() % 2 != 0 }">
            <td data-bind="text: id"></td>
            <td data-bind="text: name"></td>
            <td data-bind="text: processInstanceId"></td>
            <td data-bind="text: description"></td>
            <td data-bind="text: state"></td>
            <td> 
                <button data-bind="click: $root.takeTask"  type="button" class="btn btn-primary">
                    Assign Task to Me
                </button>
            </td>
        </tr>
        <tr>
            <td class="hiddenRow" colspan="42">
                <div class="accordian-body collapse" data-bind="attr: {id: id}">
                    <table class="detailsTable">
                        <tr>
                            <td>
                                <strong>Details for task  </strong><strong data-bind="text: id"></strong>
                                <dl class="name-value-pair">
                                    <dt>Name</dt>
                                    <dd data-bind="text: name"></dd>
                                </dl>
                                <dl class="name-value-pair">
                                    <dt>Description</dt>
                                    <dd data-bind="text: description"></dd>
                                </dl>
                                <dl class="name-value-pair">
                                    <dt>Workflow</dt>
                                    <dd data-bind="text: processInstanceId"></dd>
                                </dl>
                                <dl class="name-value-pair">
                                    <dt>Task ID</dt>
                                    <dd data-bind="text: id"></dd>
                                </dl>
                                <dl class="name-value-pair">
                                    <dt>State</dt>
                                    <dd data-bind="text: state"></dd>
                                </dl>
                                <dl class="name-value-pair">
                                    <dt>Activity Name</dt>
                                    <dd data-bind="text: activityName"></dd>
                                </dl>
                                <dl class="name-value-pair">
                                    <dt>State</dt>
                                    <dd data-bind="text: state"></dd>
                                </dl>
                                <dl class="name-value-pair">
                                    <dt>Assignee</dt>
                                    <dd data-bind="text: assignee"></dd>
                                </dl>
                            </td>
                            <td>
                                <!-- Variable edit section -->
                                <div>
                                    <strong  data-bind="css: { 'hiddenLabel': variables().length <= 0}">Variables</strong>
                                    <!-- Each variable's editors appear in a li -->
                                    <div data-bind="foreach: variables">

                                        <dl class="name-value-pair" >
                                            <dt data-bind="text: name"></dt>
                                            <dd data-bind="text: value"></dd>
                                        </dl>
                                    </div>
                                </div>
                        </td>
                        <td>
                            <!-- Form to select the task outcome, only shown when task has possible outcomes -->
                            <form id="outcomes-form" class="form-inline"
                            data-bind="visible: outcomes().length > 0">
                                <!-- help-block only shows up after the user tries to complete the task
                                without selecting an outcome -->
                                <p class="help-block hidden">Must select an outcome</p>

                                <strong class="control-label">Outcomes</strong>
                                <label data-bind="foreach: outcomes" class="radio">
                                    <input type="radio" name="selectedOutcome"
                                    data-bind="checked: $parent.selectedOutcome, value: $data"/>
                                    <!-- Display the outcome name next to its radio button -->
                                    <span data-bind="text: $data"></span>
                                </label>
                            </form>
                        </td>
                    </tr>
                </table>
            </div>


        </td>

    </tr>
</tbody>
</table>


<br/>

<!-- Explicitly reloads all task data from cow-server. Not actually necessary because of amqp,
    but might be helpful for debugging -->
    <!--button class="btn btn-primary" data-bind="enable: username, click: refreshAllTasks">
        Refresh task lists
    </button>

    <br />
    <br /-->

    <button class="btn btn-primary" data-bind="click: toggleHistory, visible: !showHistory()">
        Show history
    </button>

    <div data-bind="if: showHistory">
        <button class="btn btn-primary" data-bind="click: toggleHistory">
            Hide history
        </button>

        <table class="table table-striped">
            <caption>Task History</caption>
            <thead>
                <tr>
                    <th> ID </th>
                    <th> Assignee </th>
                    <th> Workflow </th>
                    <th> State </th>
                </tr>
            </thead>
            <tbody data-bind="foreach: historyTasks">
                <tr>
                    <td data-bind="text: id"></td>
                    <td data-bind="text: assignee"></td>
                    <td data-bind="text: executionId"></td>
                    <td data-bind="text: state"></td>
                </tr>
            </tbody>
        </table>
    </div>





</body>
</html>
